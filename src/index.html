<!DOCTYPE html>
<html>
  <head>
    <title>SVG Illustrator Test</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
      }
      #keychainsvg {
        max-height: 100vh;
      }
    </style>
  </head>
  <body>
    <object
      data="assets/executor_keychain_plain.svg"
      type="image/svg+xml"
      id="keychainsvg"
      width="100%"
      height="100%"
    ></object>

    <script src="loopify.js" type="text/javascript"></script>
    <script>
      (function(loopify) {
        const svg = document.getElementById("keychainsvg");
        // const audios = document.querySelectorAll("audio");
        // let currentIdx = 0;
        // let nowPlaying = false;

        // function initAudios() {
        //   audios.forEach(audio => {
        //     audio.addEventListener("ended", () => {
        //       if (nowPlaying) {
        //         audio.currentTime = 0;
        //         audio.play();
        //       }
        //     });
        //   });
        // }

        // function startPlaying(idx) {
        //   nowPlaying = true;
        //   currentIdx = idx;
        //   audios[currentIdx].currentTime = 0;
        //   audios[currentIdx].play();
        // }

        // function stopPlaying() {
        //   nowPlaying = false;
        //   // audios[currentIdx].pause();
        // }

        function initButtonEvents() {
          // get the inner DOM of svg
          var svgDoc = svg.contentDocument;
          // get the inner element by id
          for (let i = 1; i < 9; i++) {
            const idxStr = i.toString().padStart(2, "0");
            const btn = svgDoc.getElementById(
              `button${idxStr}`
            );
            loopify(`assets/sound${idxStr}.mp3`, function(err, loop) {
              // If something went wrong, `err` is supplied
              if (err) {
                return console.err(err);
              }

              btn.addEventListener(
                "mousedown",
                () => {
                  loop.play();
                  btn.style.opacity = 0.8;
                },
                false
              );
              btn.addEventListener(
                "mouseup",
                () => {
                  loop.stop(),
                  btn.style.opacity = 1;
                },
                false
              );
            });

            // add behaviour
            
          }
        }

        // It's important to add an load event listener to the object,
        // as it will load the svg doc asynchronously
        svg.addEventListener("load", initButtonEvents, false);
        // initAudios();
      })(loopify);
    </script>
  </body>
</html>
